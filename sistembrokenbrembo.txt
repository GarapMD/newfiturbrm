--========================================================
-- ⚡ SYSTEM BROKEN — BREMBO NEON BLUE (TARGET ONLY, 2 COL)
-- Faithful Target Logic (asli) + Tap Selector Tool
--========================================================

-- ============ SERVICES ============
local Players        = game:GetService("Players")
local RunService     = game:GetService("RunService")
local StarterGui     = game:GetService("StarterGui")
local UserInput      = game:GetService("UserInputService")
local HttpService    = game:GetService("HttpService")
local Lighting       = game:GetService("Lighting")

local plr   = Players.LocalPlayer
local mouse = plr:GetMouse()

-- ============ UTILS ============
local function Notify(t, m, d)
    pcall(function()
        StarterGui:SetCore("SendNotification", {Title=t, Text=m, Duration=d or 3})
    end)
end

local function GetPing()
    local ok,stats = pcall(function() return game:GetService("Stats") end)
    if not ok then return 0.05 end
    local itm = stats.Network.ServerStatsItem
    if itm and itm["Data Ping"] then
        return (itm["Data Ping"]:GetValue())/1000
    end
    return 0.05
end

local function Char(p) return p and p.Character end
local function Hum(p) local c=Char(p); return c and c:FindFirstChildOfClass("Humanoid") end
local function Root(p) local c=Char(p); return c and (c:FindFirstChild("HumanoidRootPart") or c:FindFirstChild("Torso")) end

local function PlayAnim(id, timepos, speed)
    pcall(function()
        local hum = Hum(plr); if not hum then return end
        for _,tr in ipairs(hum:GetPlayingAnimationTracks()) do tr:Stop() end
        local a = Instance.new("Animation"); a.AnimationId = "rbxassetid://"..id
        local tr = hum:LoadAnimation(a)
        tr:Play()
        if timepos then tr.TimePosition = timepos end
        if speed   then tr:AdjustSpeed(speed) end
    end)
end
local function StopAnim()
    pcall(function()
        local hum = Hum(plr); if not hum then return end
        for _,tr in ipairs(hum:GetPlayingAnimationTracks()) do tr:Stop() end
    end)
end

local function GetPlayer(q)
    if not q or q=="" then return nil end
    q = tostring(q):gsub("^@",""):lower()
    for _,v in ipairs(Players:GetPlayers()) do
        if v.Name:lower():match(q) or v.DisplayName:lower():match(q) then
            return v
        end
    end
end

-- TeleportTO: kompatibel dgn versi asli (bisa "pos" atau ke player)
local function TeleportTO(x,y,z,target,mode)
    local r = Root(plr); if not r then return end
    if typeof(target)=="Instance" and target:IsA("Player") then
        local rt = Root(target); if not rt then return end
        -- “safe” double-step (seperti pola asli)
        r.CFrame = rt.CFrame
        if mode=="safe" then task.wait() r.CFrame = rt.CFrame end
    else
        -- ke posisi
        r.CFrame = CFrame.new(tonumber(x) or 0, tonumber(y) or 0, tonumber(z) or 0)
        if mode=="safe" then task.wait() r.CFrame = r.CFrame end
    end
end

-- PredictionTP: dipakai di Focus/Fling aslinya
local function PredictionTP(target, safe)
    local tg = Root(target); local r = Root(plr)
    if not (tg and r) then return end
    local pos, vel = tg.Position, tg.Velocity
    local ping = GetPing()
    r.CFrame = CFrame.new(
        pos.X + vel.X*(ping*3.5),
        pos.Y + vel.Y*(ping*2.0),
        pos.Z + vel.Z*(ping*3.5)
    )
    if safe == "safe" then task.wait() r.CFrame = CFrame.new(pos) end
end

-- Push (dipanggil di Focus & tombol PUSH)
local function GetPushTool()
    local c = Char(plr)
    if c and c:FindFirstChild("Push") then return c.Push end
    if plr.Backpack:FindFirstChild("Push") then
        plr.Backpack.Push.Parent = c; return c.Push
    end
    return nil
end
local function Push(player)
    -- Versi aman (tidak semua game punya Remote)
    pcall(function()
        local P = GetPushTool()
        if P and P:FindFirstChild("PushTool") then
            P.PushTool:FireServer(Char(player))
        end
    end)
end

-- Brake helper (alias “BreakVelocity” body)
local function EnsureBrake(bodyParent)
    if bodyParent:FindFirstChild("BreakVelocity") then return bodyParent.BreakVelocity end
    local bav = Instance.new("BodyAngularVelocity")
    bav.Name = "BreakVelocity"
    bav.AngularVelocity = Vector3.new(0,0,0)
    bav.MaxTorque = Vector3.new(1e6,1e6,1e6)
    bav.P = 1e5
    bav.Parent = bodyParent
    return bav
end

-- ============ STATE ============
local TargetedPlayer : Player? = nil

-- ============ GUI (Brembo Neon Blue Compact 2 Kolom) ============
local gui = Instance.new("ScreenGui")
gui.Name = "BremboSysBroken_TargetOnly"
gui.IgnoreGuiInset = true
pcall(function() gui.Parent = game:GetService("CoreGui") end)

-- Launcher “⚡ System Broken”
local launcher = Instance.new("TextButton")
launcher.Name = "Launcher"
launcher.Parent = gui
launcher.Size = UDim2.new(0,170,0,38)
launcher.Position = UDim2.new(1,-180,1,-48) -- kanan bawah
launcher.BackgroundColor3 = Color3.fromRGB(15,25,35)
launcher.BackgroundTransparency = 0.25
launcher.AutoButtonColor = true
launcher.Text = "⚡ System Broken"
launcher.TextColor3 = Color3.fromRGB(200,245,255)
launcher.TextSize = 20
launcher.Font = Enum.Font.SourceSansBold
launcher.Active = true
launcher.Draggable = true
do
    local c = Instance.new("UICorner", launcher); c.CornerRadius = UDim.new(0,12)
    local s = Instance.new("UIStroke", launcher); s.Thickness = 2; s.Color = Color3.fromRGB(0,220,255)
end

-- Main Window (compact 350x400)
local win = Instance.new("Frame", gui)
win.Name = "Window"
win.Size = UDim2.new(0,350,0,400)
win.Position = UDim2.new(0.5,-175,0.5,-200)
win.BackgroundColor3 = Color3.fromRGB(15,25,35)
win.BackgroundTransparency = 0.2
win.Visible = false
win.Active = true
win.Draggable = true
do
    local c = Instance.new("UICorner", win); c.CornerRadius = UDim.new(0,14)
    local s = Instance.new("UIStroke", win); s.Thickness = 2; s.Color = Color3.fromRGB(0,220,255)
end

-- Header
local title = Instance.new("TextLabel", win)
title.Size = UDim2.new(1,-100,0,34)
title.Position = UDim2.new(0,12,0,10)
title.BackgroundTransparency = 1
title.Font = Enum.Font.Oswald
title.TextSize = 22
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextColor3 = Color3.fromRGB(200,245,255)
title.Text = "System Broken — Target"

local brand = Instance.new("TextLabel", win)
brand.Size = UDim2.new(0,160,0,22)
brand.Position = UDim2.new(1,-168,0,12)
brand.BackgroundTransparency = 1
brand.Font = Enum.Font.SourceSansBold
brand.TextSize = 16
brand.TextXAlignment = Enum.TextXAlignment.Right
brand.TextColor3 = Color3.fromRGB(0,230,255)
brand.Text = "Brembo Gaming"

local btnMin = Instance.new("TextButton", win)
btnMin.Size = UDim2.new(0,28,0,22)
btnMin.Position = UDim2.new(1,-64,0,10)
btnMin.BackgroundColor3 = Color3.fromRGB(25,40,55)
btnMin.BackgroundTransparency = 0.15
btnMin.Text = "➖"
btnMin.TextColor3 = Color3.fromRGB(180,220,255)
btnMin.Font = Enum.Font.SourceSansBold
btnMin.TextSize = 18
Instance.new("UICorner", btnMin).CornerRadius = UDim.new(0,8)

local btnClose = Instance.new("TextButton", win)
btnClose.Size = UDim2.new(0,28,0,22)
btnClose.Position = UDim2.new(1,-32,0,10)
btnClose.BackgroundColor3 = Color3.fromRGB(25,40,55)
btnClose.BackgroundTransparency = 0.15
btnClose.Text = "✖"
btnClose.TextColor3 = Color3.fromRGB(220,240,255)
btnClose.Font = Enum.Font.SourceSansBold
btnClose.TextSize = 18
Instance.new("UICorner", btnClose).CornerRadius = UDim.new(0,8)

-- Container Target (2 kolom)
local body = Instance.new("Frame", win)
body.Size = UDim2.new(1,-24,1,-56)
body.Position = UDim2.new(0,12,0,44)
body.BackgroundTransparency = 1

local function neonButton(parent, text, x, y)
    local b = Instance.new("TextButton", parent)
    b.Size = UDim2.new(0.48,0,0,32)
    b.Position = UDim2.new(x,0,y,0)
    b.BackgroundColor3 = Color3.fromRGB(18,30,44)
    b.BackgroundTransparency = 0.08
    b.Text = text
    b.TextColor3 = Color3.fromRGB(220,245,255)
    b.Font = Enum.Font.SourceSansBold
    b.TextSize = 16
    local c = Instance.new("UICorner", b); c.CornerRadius = UDim.new(0,8)
    local s = Instance.new("UIStroke", b); s.Thickness = 1.3; s.Color = Color3.fromRGB(0,210,255)
    return b
end

local function toggleLook(btn, on)
    btn.BackgroundColor3 = on and Color3.fromRGB(10,55,70) or Color3.fromRGB(18,30,44)
end

-- Target textbox + pointer icon (Tap Selector trigger)
local targetBoxFrame = Instance.new("Frame", body)
targetBoxFrame.Size = UDim2.new(1,0,0,34)
targetBoxFrame.BackgroundColor3 = Color3.fromRGB(18,30,44)
targetBoxFrame.BackgroundTransparency = 0.08
local c1 = Instance.new("UICorner", targetBoxFrame); c1.CornerRadius = UDim.new(0,8)
local s1 = Instance.new("UIStroke", targetBoxFrame); s1.Thickness = 1.3; s1.Color = Color3.fromRGB(0,210,255)

local targetBox = Instance.new("TextBox", targetBoxFrame)
targetBox.Size = UDim2.new(1,-40,1,0)
targetBox.Position = UDim2.new(0,8,0,0)
targetBox.BackgroundTransparency = 1
targetBox.PlaceholderText = "@target (ketik / Tap-Tool)"
targetBox.ClearTextOnFocus = false
targetBox.Font = Enum.Font.SourceSansBold
targetBox.TextSize = 16
targetBox.TextColor3 = Color3.fromRGB(220,245,255)

local clickToolBtn = Instance.new("ImageButton", targetBoxFrame)
clickToolBtn.Size = UDim2.new(0,26,0,26)
clickToolBtn.Position = UDim2.new(1,-30,0,4)
clickToolBtn.BackgroundTransparency = 1
clickToolBtn.Image = "rbxassetid://2716591855" -- ikon telunjuk

-- Tombol TARGET (2 kolom)
local btnFocus     = neonButton(body,"Focus",        0.00, 0.18)
local btnBang      = neonButton(body,"Bang (T)",     0.52, 0.18)
local btnStand     = neonButton(body,"Stand (T)",    0.00, 0.30)
local btnHeadsit   = neonButton(body,"Headsit (T)",  0.52, 0.30)
local btnDoggy     = neonButton(body,"Doggy (T)",    0.00, 0.42)
local btnBackpack  = neonButton(body,"Backpack (T)", 0.52, 0.42)
local btnDrag      = neonButton(body,"Drag (T)",     0.00, 0.54)
local btnPushOnce  = neonButton(body,"Push Once",    0.52, 0.54)

-- ============ Tap Selector Tool ============
local TapTool -- dibuat saat klik ikon telunjuk
local tapConn

local function removeTapTool()
    if tapConn then tapConn:Disconnect() tapConn=nil end
    if TapTool then TapTool:Destroy() TapTool=nil end
end

local function makeTapTool()
    removeTapTool()
    TapTool = Instance.new("Tool")
    TapTool.RequiresHandle = false
    TapTool.Name = "Tap Selector"
    TapTool.Parent = plr.Backpack
    Notify("System Broken","Tap Selector siap. Equip lalu tap player.",4)

    TapTool.Activated:Connect(function()
        -- ketika di-equip & klik objek
        local target = mouse.Target
        if not target then return end
        local model = target:FindFirstAncestorWhichIsA("Model")
        if not model then return end
        local p = Players:GetPlayerFromCharacter(model)
        if p then
            TargetedPlayer = p
            targetBox.Text = "@"..p.Name
            Notify("Target","Set: @"..p.Name,3)
        end
    end)
end

clickToolBtn.MouseButton1Click:Connect(function()
    makeTapTool()
end)

-- ============ Target core helpers ============
local function setTargetFromBox(text)
    if not text or text=="" then return end
    if not text:find("^@") then
        text = "@"..text
        targetBox.Text = text
    end
    TargetedPlayer = GetPlayer(text)
    if TargetedPlayer then
        Notify("Target","Set: @"..TargetedPlayer.Name,3)
    else
        Notify("Target","Player tidak ditemukan.",3)
    end
end

targetBox.FocusLost:Connect(function(enter) if enter then setTargetFromBox(targetBox.Text) end end)

-- ============ TARGET LOGIC (1:1 ASLI) ============
-- Status toggle
local onFocus=false; local onBang=false; local onHeadsit=false; local onStand=false; local onBackpack=false; local onDoggy=false; local onDrag=false

-- FOCUS (loop: TeleportTO(0,0,0,target) + Push)
btnFocus.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onFocus = not onFocus; toggleLook(btnFocus,onFocus)
    if onFocus then
        task.spawn(function()
            while onFocus do
                pcall(function()
                    local t = TargetedPlayer
                    TeleportTO(0,0,0,t)      -- sama seperti asli
                    Push(t)                  -- dorong untuk “melekat”
                end)
                task.wait(0.2)
            end
        end)
    end
end)

-- BANG (anim 5918726674, posisi belakang pinggang)
btnBang.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onBang = not onBang; toggleLook(btnBang,onBang)
    if onBang then
        PlayAnim(5918726674,0,1)
        task.spawn(function()
            while onBang do
                pcall(function()
                    local r = Root(plr); local ro = Root(TargetedPlayer); if not (r and ro) then return end
                    EnsureBrake(r)
                    r.CFrame = ro.CFrame * CFrame.new(0,0,1.1)  -- tepat di belakang
                    r.Velocity = Vector3.new()
                end)
                task.wait()
            end
        end)
    else
        StopAnim()
        local r=Root(plr); if r and r:FindFirstChild("BreakVelocity") then r.BreakVelocity:Destroy() end
    end
end)

-- HEADSIT (duduk di atas kepala target)
btnHeadsit.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onHeadsit = not onHeadsit; toggleLook(btnHeadsit,onHeadsit)
    if onHeadsit then
        task.spawn(function()
            while onHeadsit do
                pcall(function()
                    local r=Root(plr); local head = Char(TargetedPlayer) and Char(TargetedPlayer):FindFirstChild("Head")
                    if not (r and head) then return end
                    EnsureBrake(r)
                    Hum(plr).Sit = true
                    r.CFrame = head.CFrame * CFrame.new(0,2,0)
                    r.Velocity = Vector3.new()
                end)
                task.wait()
            end
        end)
    else
        local r=Root(plr); if r and r:FindFirstChild("BreakVelocity") then r.BreakVelocity:Destroy() end
    end
end)

-- STAND (pose menunjuk diam di sisi kiri, anim 13823324057 @4s, offset -3,1,0)
btnStand.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onStand = not onStand; toggleLook(btnStand,onStand)
    if onStand then
        PlayAnim(13823324057,4,0)
        task.spawn(function()
            while onStand do
                pcall(function()
                    local r=Root(plr); local ro=Root(TargetedPlayer); if not (r and ro) then return end
                    EnsureBrake(r)
                    r.CFrame = ro.CFrame * CFrame.new(-3,1,0)
                    r.Velocity = Vector3.new()
                end)
                task.wait()
            end
        end)
    else
        StopAnim()
        local r=Root(plr); if r and r:FindFirstChild("BreakVelocity") then r.BreakVelocity:Destroy() end
    end
end)

-- BACKPACK (duduk membelakangi punggung target, rotasi -3 rad)
btnBackpack.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onBackpack = not onBackpack; toggleLook(btnBackpack,onBackpack)
    if onBackpack then
        task.spawn(function()
            while onBackpack do
                pcall(function()
                    local r=Root(plr); local ro=Root(TargetedPlayer); if not (r and ro) then return end
                    EnsureBrake(r)
                    Hum(plr).Sit = true
                    r.CFrame = ro.CFrame * CFrame.new(0,0,1.2) * CFrame.Angles(0,-3,0)
                    r.Velocity = Vector3.new()
                end)
                task.wait()
            end
        end)
    else
        local r=Root(plr); if r and r:FindFirstChild("BreakVelocity") then r.BreakVelocity:Destroy() end
    end
end)

-- DOGGY (anim 13694096724 @3.4s paused, nempel LowerTorso 0,0.23,0)
btnDoggy.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onDoggy = not onDoggy; toggleLook(btnDoggy,onDoggy)
    if onDoggy then
        PlayAnim(13694096724,3.4,0)
        task.spawn(function()
            while onDoggy do
                pcall(function()
                    local r=Root(plr)
                    local lt = Char(TargetedPlayer) and Char(TargetedPlayer):FindFirstChild("LowerTorso")
                    if not (r and lt) then return end
                    EnsureBrake(r)
                    r.CFrame = lt.CFrame * CFrame.new(0,0.23,0)
                    r.Velocity = Vector3.new()
                end)
                task.wait()
            end
        end)
    else
        StopAnim()
        local r=Root(plr); if r and r:FindFirstChild("BreakVelocity") then r.BreakVelocity:Destroy() end
    end
end)

-- DRAG (anim 10714360343 @0.5s paused, nempel RightHand offset dan rotasi)
btnDrag.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    onDrag = not onDrag; toggleLook(btnDrag,onDrag)
    if onDrag then
        PlayAnim(10714360343,0.5,0)
        task.spawn(function()
            while onDrag do
                pcall(function()
                    local r=Root(plr)
                    local rh = Char(TargetedPlayer) and Char(TargetedPlayer):FindFirstChild("RightHand")
                    if not (r and rh) then return end
                    EnsureBrake(r)
                    r.CFrame = rh.CFrame * CFrame.new(0,-2.5,1) * CFrame.Angles(-2,-3,0)
                    r.Velocity = Vector3.new()
                end)
                task.wait()
            end
        end)
    else
        StopAnim()
        local r=Root(plr); if r and r:FindFirstChild("BreakVelocity") then r.BreakVelocity:Destroy() end
    end
end)

-- PUSH ONCE (sama dengan tombol Push di asli: prediksi dulu, lalu push, lalu balik)
btnPushOnce.MouseButton1Click:Connect(function()
    if not TargetedPlayer then return Notify("Target","Set @target dulu.",3) end
    pcall(function()
        local r = Root(plr); if not r then return end
        local keep = r.CFrame
        PredictionTP(TargetedPlayer)
        task.wait(GetPing()+0.05)
        Push(TargetedPlayer)
        r.CFrame = keep
    end)
end)

-- ============ OPEN / CLOSE ============
local function openGUI()  win.Visible=true end
local function hideGUI()  win.Visible=false end
local function closeGUI() gui:Destroy() end
launcher.MouseButton1Click:Connect(openGUI)
btnMin.MouseButton1Click:Connect(hideGUI)
btnClose.MouseButton1Click:Connect(closeGUI)

-- Hotkey (opsional) B untuk hide/show
UserInput.InputBegan:Connect(function(inp,gp)
    if gp then return end
    if inp.KeyCode == Enum.KeyCode.B then
        win.Visible = not win.Visible
    end
end)

Notify("System Broken","Launcher siap — klik '⚡ System Broken' untuk membuka GUI.",4)